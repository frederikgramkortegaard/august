2025/09/01 23:28:25 Genesis block created with nonce 0, hash: 50c43c52d983eeca05cd65608f9d1af6fe162db9bb6cc74858915a14941a1255
2025/09/01 23:28:25 FirstUser 993fe6a36d19ed52 receives 10M initial coins
=== RUN   TestLongestChainResolution
    longest_chain_resolution_test.go:14: === Testing Longest Chain Resolution with Multiple Candidates ===
2025/09/01 23:28:25 node-A	Blockchain initialized with genesis block
2025/09/01 23:28:25 node-A	Starting P2P server on port 19090
2025/09/01 23:28:25 node-A	P2P server listening on port 19090
2025/09/01 23:28:25 node-A	Starting peer discovery...
2025/09/01 23:28:25 node-A	Starting peer discovery with 0 seed peers
2025/09/01 23:28:25 node-A	Peer discovery started successfully
2025/09/01 23:28:25 node-A	Full node started: P2P on :19090
2025/09/01 23:28:25 node-B	Blockchain initialized with genesis block
2025/09/01 23:28:25 node-B	Starting P2P server on port 19091
2025/09/01 23:28:25 node-B	P2P server listening on port 19091
2025/09/01 23:28:25 node-B	Starting peer discovery...
2025/09/01 23:28:25 node-B	Starting peer discovery with 0 seed peers
2025/09/01 23:28:25 node-B	Peer discovery started successfully
2025/09/01 23:28:25 node-B	Full node started: P2P on :19091
2025/09/01 23:28:25 node-C	Blockchain initialized with genesis block
2025/09/01 23:28:25 node-C	Starting P2P server on port 19092
2025/09/01 23:28:25 node-C	P2P server listening on port 19092
2025/09/01 23:28:25 node-C	Starting peer discovery...
2025/09/01 23:28:25 node-C	Starting peer discovery with 0 seed peers
2025/09/01 23:28:25 node-C	Peer discovery started successfully
2025/09/01 23:28:25 node-C	Full node started: P2P on :19092
2025/09/01 23:28:25 evaluator	Blockchain initialized with genesis block
2025/09/01 23:28:25 evaluator	Starting P2P server on port 19093
2025/09/01 23:28:25 evaluator	P2P server listening on port 19093
2025/09/01 23:28:25 evaluator	Starting peer discovery...
2025/09/01 23:28:25 evaluator	Starting peer discovery with 3 seed peers
2025/09/01 23:28:25 evaluator	Peer discovery started successfully
2025/09/01 23:28:25 evaluator	Full node started: P2P on :19093
    longest_chain_resolution_test.go:59: === Phase 1: Building Different Chains on Each Node ===
2025/09/01 23:28:25 evaluator	Attempting to connect to peer: 127.0.0.1:19090
2025/09/01 23:28:25 evaluator	Attempting to connect to peer: 127.0.0.1:19092
2025/09/01 23:28:25 evaluator	Attempting to connect to peer: 127.0.0.1:19091
2025/09/01 23:28:25 evaluator	TCP connection established to peer: 127.0.0.1:19092
2025/09/01 23:28:25 evaluator	New peer connection from: 127.0.0.1:19092
2025/09/01 23:28:25 evaluator	Peer 127.0.0.1:19092 connected
2025/09/01 23:28:25 evaluator	Sending handshake to 127.0.0.1:19092
2025/09/01 23:28:25 node-B	New peer connection from: 127.0.0.1:59491
2025/09/01 23:28:25 node-B	Peer 127.0.0.1:59491 connected
2025/09/01 23:28:25 node-B	Sending handshake to 127.0.0.1:59491
2025/09/01 23:28:25 node-C	New peer connection from: 127.0.0.1:59490
2025/09/01 23:28:25 node-C	Peer 127.0.0.1:59490 connected
2025/09/01 23:28:25 node-C	Sending handshake to 127.0.0.1:59490
2025/09/01 23:28:25 node-B	Sending handshake message to 127.0.0.1:59491 (port: 19091)
2025/09/01 23:28:25 node-A	New peer connection from: 127.0.0.1:59489
2025/09/01 23:28:25 node-A	Peer 127.0.0.1:59489 connected
2025/09/01 23:28:25 node-A	Sending handshake to 127.0.0.1:59489
2025/09/01 23:28:25 node-A	Sending handshake message to 127.0.0.1:59489 (port: 19090)
2025/09/01 23:28:25 evaluator	TCP connection established to peer: 127.0.0.1:19091
2025/09/01 23:28:25 evaluator	New peer connection from: 127.0.0.1:19091
2025/09/01 23:28:25 evaluator	Peer 127.0.0.1:19091 connected
2025/09/01 23:28:25 evaluator	Sending handshake to 127.0.0.1:19091
2025/09/01 23:28:25 evaluator	Sending handshake message to 127.0.0.1:19091 (port: 19093)
2025/09/01 23:28:25 evaluator	Starting message handler for 127.0.0.1:19091
2025/09/01 23:28:25 evaluator	TCP connection established to peer: 127.0.0.1:19090
2025/09/01 23:28:25 evaluator	New peer connection from: 127.0.0.1:19090
2025/09/01 23:28:25 evaluator	Peer 127.0.0.1:19090 connected
2025/09/01 23:28:25 evaluator	Sending handshake to 127.0.0.1:19090
2025/09/01 23:28:25 evaluator	Sending handshake message to 127.0.0.1:19090 (port: 19093)
2025/09/01 23:28:25 evaluator	Starting message handler for 127.0.0.1:19090
2025/09/01 23:28:25 node-B	Starting message handler for 127.0.0.1:59491
2025/09/01 23:28:25 evaluator	Received message type handshake from 127.0.0.1:19091
2025/09/01 23:28:25 node-B	Received message type handshake from 127.0.0.1:59491
2025/09/01 23:28:25 evaluator	Sending handshake message to 127.0.0.1:19092 (port: 19093)
2025/09/01 23:28:25 evaluator	Starting message handler for 127.0.0.1:19092
2025/09/01 23:28:25 node-B	Handshake debug: current=127.0.0.1:59491, proper=127.0.0.1:19093, listenPort=19093
2025/09/01 23:28:25 node-B	Updating peer address from 127.0.0.1:59491 to 127.0.0.1:19093
2025/09/01 23:28:25 node-B	Received handshake from evaluator (height: 1)
2025/09/01 23:28:25 node-C	Sending handshake message to 127.0.0.1:59490 (port: 19092)
2025/09/01 23:28:25 node-C	Starting message handler for 127.0.0.1:59490
2025/09/01 23:28:25 node-A	Starting message handler for 127.0.0.1:59489
2025/09/01 23:28:25 node-C	Received message type handshake from 127.0.0.1:59490
2025/09/01 23:28:25 node-A	Received message type handshake from 127.0.0.1:59489
2025/09/01 23:28:25 node-A	Handshake debug: current=127.0.0.1:59489, proper=127.0.0.1:19093, listenPort=19093
2025/09/01 23:28:25 node-A	Updating peer address from 127.0.0.1:59489 to 127.0.0.1:19093
2025/09/01 23:28:25 node-A	Received handshake from evaluator (height: 1)
2025/09/01 23:28:25 node-C	Handshake debug: current=127.0.0.1:59490, proper=127.0.0.1:19093, listenPort=19093
2025/09/01 23:28:25 node-C	Updating peer address from 127.0.0.1:59490 to 127.0.0.1:19093
2025/09/01 23:28:25 node-C	Received handshake from evaluator (height: 1)
2025/09/01 23:28:25 evaluator	Handshake debug: current=127.0.0.1:19091, proper=127.0.0.1:19091, listenPort=19091
2025/09/01 23:28:25 evaluator	Received handshake from node-B (height: 5)
2025/09/01 23:28:25 evaluator	Received message type handshake from 127.0.0.1:19090
2025/09/01 23:28:25 evaluator	Handshake debug: current=127.0.0.1:19090, proper=127.0.0.1:19090, listenPort=19090
2025/09/01 23:28:25 evaluator	Received handshake from node-A (height: 4)
2025/09/01 23:28:25 evaluator	Received message type handshake from 127.0.0.1:19092
2025/09/01 23:28:25 evaluator	Handshake debug: current=127.0.0.1:19092, proper=127.0.0.1:19092, listenPort=19092
2025/09/01 23:28:25 evaluator	Received handshake from node-C (height: 1)
2025/09/01 23:28:25 evaluator	Handshake completed with peer: 127.0.0.1:19092
2025/09/01 23:28:25 evaluator	Handshake completed with peer: 127.0.0.1:19091
2025/09/01 23:28:25 evaluator	Handshake completed with peer: 127.0.0.1:19090
2025/09/01 23:28:25 evaluator	Seed connection attempts completed: 3/3 successful
    longest_chain_resolution_test.go:106: Chain A: 3 blocks, work=7
    longest_chain_resolution_test.go:107: Chain B: 4 blocks, work=13
    longest_chain_resolution_test.go:108: Chain C: 2 blocks, work=41
    longest_chain_resolution_test.go:118: === Phase 2: Connecting Evaluator to Other Nodes ===
2025/09/01 23:28:25 evaluator	Manual discovery check: 3 connected peers: [127.0.0.1:19090 127.0.0.1:19092 127.0.0.1:19091]
2025/09/01 23:28:25 evaluator	Starting peer sharing and connect sequence
2025/09/01 23:28:25 node-C	Received message type request_peers from 127.0.0.1:19093
2025/09/01 23:28:25 node-C	Shared 0 peers with 127.0.0.1:19093
2025/09/01 23:28:25 evaluator	Received message type share_peers from 127.0.0.1:19092
2025/09/01 23:28:25 evaluator	Delivered response for request 031d7bca1680e2a0
2025/09/01 23:28:25 evaluator	Received 0 peers from 127.0.0.1:19092
2025/09/01 23:28:25 node-B	Received message type request_peers from 127.0.0.1:19093
2025/09/01 23:28:25 node-B	Shared 0 peers with 127.0.0.1:19093
2025/09/01 23:28:25 evaluator	Received message type share_peers from 127.0.0.1:19091
2025/09/01 23:28:25 evaluator	Delivered response for request 32eec615794de810
2025/09/01 23:28:25 evaluator	Received 0 peers from 127.0.0.1:19091
2025/09/01 23:28:25 node-A	Received message type request_peers from 127.0.0.1:19093
2025/09/01 23:28:25 node-A	Shared 0 peers with 127.0.0.1:19093
2025/09/01 23:28:25 evaluator	Received message type share_peers from 127.0.0.1:19090
2025/09/01 23:28:25 evaluator	Delivered response for request 00a9fd11e15d7a14
2025/09/01 23:28:25 evaluator	Received 0 peers from 127.0.0.1:19090
2025/09/01 23:28:25 evaluator	Successfully requested peers from 3 peers
2025/09/01 23:28:25 evaluator	Now attempting to connect to discovered peers
2025/09/01 23:28:25 evaluator	Discovery round completed
    longest_chain_resolution_test.go:127: === Phase 3: Sending Chain Head Announcements ===
    longest_chain_resolution_test.go:135: Sending Chain A head to evaluator
2025/09/01 23:28:26 evaluator	Evaluating chain from 127.0.0.1:19090: our height=0 work=1, peer height=3 work=7
2025/09/01 23:28:26 evaluator	Peer chain looks better, downloading headers from 127.0.0.1:19090
2025/09/01 23:28:26 node-A	Received message type request_headers from 127.0.0.1:19093
2025/09/01 23:28:26 node-A	Sent 3 headers to 127.0.0.1:19093
2025/09/01 23:28:26 evaluator	Received message type headers from 127.0.0.1:19090
2025/09/01 23:28:26 evaluator	Delivered response for request 3eae647538f20941
2025/09/01 23:28:26 evaluator	Received 3 headers from 127.0.0.1:19090 starting at height 1
2025/09/01 23:28:26 evaluator	Headers validated and better, starting candidate chain download
2025/09/01 23:28:26 evaluator	Created candidate chain 127.0.0.1:19090-3-OJ4PmX1OYxgfmlA+
2025/09/01 23:28:26 evaluator	Starting block download for candidate 127.0.0.1:19090-3-OJ4PmX1OYxgfmlA+
2025/09/01 23:28:26 evaluator	Candidate 127.0.0.1:19090-3-OJ4PmX1OYxgfmlA+: downloading blocks 1-3
2025/09/01 23:28:26 node-A	Received message type request_blocks from 127.0.0.1:19093
2025/09/01 23:28:26 node-A	Sent 3 blocks to 127.0.0.1:19093
2025/09/01 23:28:26 evaluator	Received message type blocks from 127.0.0.1:19090
2025/09/01 23:28:26 evaluator	Delivered response for request f5e512be6cd9723b
2025/09/01 23:28:26 evaluator	Received 3 blocks from 127.0.0.1:19090 starting at height 1
2025/09/01 23:28:26 evaluator	Candidate 127.0.0.1:19090-3-OJ4PmX1OYxgfmlA+: added 3 blocks, now at height 3
2025/09/01 23:28:26 evaluator	Candidate 127.0.0.1:19090-3-OJ4PmX1OYxgfmlA+: download complete, evaluating for promotion
2025/09/01 23:28:26 evaluator	Candidate 127.0.0.1:19090-3-OJ4PmX1OYxgfmlA+ has better work, promoting to active chain
2025/09/01 23:28:26 evaluator	Successfully promoted candidate 127.0.0.1:19090-3-OJ4PmX1OYxgfmlA+ to active chain (height 2)
    longest_chain_resolution_test.go:142: Sending Chain B head to evaluator
2025/09/01 23:28:26 evaluator	Evaluating chain from 127.0.0.1:19091: our height=3 work=7, peer height=4 work=13
2025/09/01 23:28:26 evaluator	Peer chain looks better, downloading headers from 127.0.0.1:19091
2025/09/01 23:28:26 node-B	Received message type request_headers from 127.0.0.1:19093
2025/09/01 23:28:26 node-B	Sent 4 headers to 127.0.0.1:19093
2025/09/01 23:28:26 evaluator	Received message type headers from 127.0.0.1:19091
2025/09/01 23:28:26 evaluator	Delivered response for request 6824b39310592484
2025/09/01 23:28:26 evaluator	Received 4 headers from 127.0.0.1:19091 starting at height 1
2025/09/01 23:28:26 evaluator	Headers validated and better, starting candidate chain download
2025/09/01 23:28:26 evaluator	Created candidate chain 127.0.0.1:19091-4-Fc7ekO2KUitS7o2y
2025/09/01 23:28:26 evaluator	Starting block download for candidate 127.0.0.1:19091-4-Fc7ekO2KUitS7o2y
2025/09/01 23:28:26 evaluator	Candidate 127.0.0.1:19091-4-Fc7ekO2KUitS7o2y: downloading blocks 1-4
2025/09/01 23:28:26 node-B	Received message type request_blocks from 127.0.0.1:19093
2025/09/01 23:28:26 node-B	Sent 4 blocks to 127.0.0.1:19093
2025/09/01 23:28:26 evaluator	Received message type blocks from 127.0.0.1:19091
2025/09/01 23:28:26 evaluator	Delivered response for request 7d1071ad14ed22e1
2025/09/01 23:28:26 evaluator	Received 4 blocks from 127.0.0.1:19091 starting at height 1
2025/09/01 23:28:26 evaluator	Candidate 127.0.0.1:19091-4-Fc7ekO2KUitS7o2y: added 4 blocks, now at height 4
2025/09/01 23:28:26 evaluator	Candidate 127.0.0.1:19091-4-Fc7ekO2KUitS7o2y: download complete, evaluating for promotion
2025/09/01 23:28:26 evaluator	Candidate 127.0.0.1:19091-4-Fc7ekO2KUitS7o2y has better work, promoting to active chain
2025/09/01 23:28:26 evaluator	Successfully promoted candidate 127.0.0.1:19091-4-Fc7ekO2KUitS7o2y to active chain (height 3)
    longest_chain_resolution_test.go:149: Sending Chain C head to evaluator (should win!)
2025/09/01 23:28:26 evaluator	Evaluating chain from 127.0.0.1:19092: our height=4 work=13, peer height=2 work=41
2025/09/01 23:28:26 evaluator	Peer chain looks better, downloading headers from 127.0.0.1:19092
2025/09/01 23:28:26 node-C	Received message type request_headers from 127.0.0.1:19093
2025/09/01 23:28:26 node-C	Sent 2 headers to 127.0.0.1:19093
2025/09/01 23:28:26 evaluator	Received message type headers from 127.0.0.1:19092
2025/09/01 23:28:26 evaluator	Delivered response for request 1d01094ac90b3a9b
2025/09/01 23:28:26 evaluator	Received 2 headers from 127.0.0.1:19092 starting at height 1
2025/09/01 23:28:26 evaluator	Headers validated and better, starting candidate chain download
2025/09/01 23:28:26 evaluator	Created candidate chain 127.0.0.1:19092-2-AAAF6Ys9WjluidU9
    longest_chain_resolution_test.go:155: === Phase 4: Monitoring Chain Resolution ===
2025/09/01 23:28:26 evaluator	Starting block download for candidate 127.0.0.1:19092-2-AAAF6Ys9WjluidU9
2025/09/01 23:28:26 evaluator	Candidate 127.0.0.1:19092-2-AAAF6Ys9WjluidU9: downloading blocks 1-2
    longest_chain_resolution_test.go:182: Active candidates: 1
2025/09/01 23:28:26 node-C	Received message type request_blocks from 127.0.0.1:19093
2025/09/01 23:28:26 node-C	Sent 2 blocks to 127.0.0.1:19093
2025/09/01 23:28:26 evaluator	Received message type blocks from 127.0.0.1:19092
2025/09/01 23:28:26 evaluator	Delivered response for request 80db51a77d705eca
2025/09/01 23:28:26 evaluator	Received 2 blocks from 127.0.0.1:19092 starting at height 1
2025/09/01 23:28:26 evaluator	Candidate 127.0.0.1:19092-2-AAAF6Ys9WjluidU9: added 2 blocks, now at height 2
2025/09/01 23:28:26 evaluator	Candidate 127.0.0.1:19092-2-AAAF6Ys9WjluidU9: download complete, evaluating for promotion
2025/09/01 23:28:26 evaluator	Candidate 127.0.0.1:19092-2-AAAF6Ys9WjluidU9 has better work, promoting to active chain
2025/09/01 23:28:26 evaluator	Successfully promoted candidate 127.0.0.1:19092-2-AAAF6Ys9WjluidU9 to active chain (height 1)
    longest_chain_resolution_test.go:169: ✓ Evaluator adopted Chain C with work 41
    longest_chain_resolution_test.go:192: === Phase 5: Verifying Optimal Chain Selection ===
    longest_chain_resolution_test.go:197: Chain C original length: 3 blocks
    longest_chain_resolution_test.go:198: Evaluator final length: 2 blocks
    longest_chain_resolution_test.go:199: Chain C work: 41
    longest_chain_resolution_test.go:200: Evaluator final work: 41
    longest_chain_resolution_test.go:208: ✓ Correct work achieved - longest chain rule working!
    longest_chain_resolution_test.go:219: === Phase 6: Verifying Cleanup of Losing Candidates ===
    longest_chain_resolution_test.go:234: ✓ Longest chain resolution successful - Chain C (highest work) was chosen!
2025/09/01 23:28:27 evaluator	Stopping FullNode...
2025/09/01 23:28:27 evaluator	Error decoding message from peer 127.0.0.1:19090: read tcp 127.0.0.1:59489->127.0.0.1:19090: use of closed network connection
2025/09/01 23:28:27 evaluator	Error decoding message from peer 127.0.0.1:19092: read tcp 127.0.0.1:59490->127.0.0.1:19092: use of closed network connection
2025/09/01 23:28:27 evaluator	Error decoding message from peer 127.0.0.1:19091: read tcp 127.0.0.1:59491->127.0.0.1:19091: use of closed network connection
2025/09/01 23:28:27 Discovery stopped
2025/09/01 23:28:27 FullNode stopped successfully
2025/09/01 23:28:27 node-C	Stopping FullNode...
2025/09/01 23:28:27 node-A	Peer 127.0.0.1:19093 disconnected
2025/09/01 23:28:27 node-C	Peer 127.0.0.1:19093 disconnected
2025/09/01 23:28:27 Discovery stopped
2025/09/01 23:28:27 FullNode stopped successfully
2025/09/01 23:28:27 node-B	Stopping FullNode...
2025/09/01 23:28:27 node-B	Peer 127.0.0.1:19093 disconnected
2025/09/01 23:28:27 Discovery stopped
2025/09/01 23:28:27 FullNode stopped successfully
2025/09/01 23:28:27 node-A	Stopping FullNode...
2025/09/01 23:28:27 Discovery stopped
2025/09/01 23:28:27 FullNode stopped successfully
--- PASS: TestLongestChainResolution (1.89s)
PASS
ok  	gocuria/tests	(cached)
